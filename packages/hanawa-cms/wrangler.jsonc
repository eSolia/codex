{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "esolia-hanawa",
  "compatibility_date": "2025-01-01",
  "compatibility_flags": ["nodejs_compat"],

  // Workers format (migrated from Pages)
  "main": ".svelte-kit/cloudflare/_worker.js",
  "assets": {
    "directory": ".svelte-kit/cloudflare",
    "binding": "ASSETS",
  },

  // Enable preview URLs for PR deployments
  "preview_urls": true,
  "workers_dev": true,

  // Observability
  "observability": {
    "enabled": true,
    "logs": {
      "enabled": true,
      "invocation_logs": true,
      "head_sampling_rate": 1,
    },
    "traces": {
      "enabled": true,
      "head_sampling_rate": 1,
    },
  },

  // Custom domain: hanawa.esolia.co.jp
  // Configure in Cloudflare Workers dashboard under Domains & Routes

  // D1 Database for content, fragments, users
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "hanawa-db",
      "database_id": "0b00e3b9-528c-4620-a7f8-c4cbba0dc62b",
    },
  ],

  // R2 Bucket for published content and assets
  "r2_buckets": [
    {
      "binding": "R2",
      "bucket_name": "codex",
    },
  ],

  // KV for sessions (optional, can use D1)
  // "kv_namespaces": [
  //   {
  //     "binding": "SESSIONS",
  //     "id": "YOUR_KV_NAMESPACE_ID"
  //   }
  // ],

  // Workers AI for embeddings and generation
  "ai": {
    "binding": "AI",
  },

  // Service binding to PDF Worker (bypasses WAF, no API key needed)
  "services": [
    {
      "binding": "PDF_SERVICE",
      "service": "pdf-worker",
    },
  ],

  // Vectorize for semantic search (create with: wrangler vectorize create codex-index --dimensions=768 --metric=cosine)
  "vectorize": [
    {
      "binding": "VECTORIZE",
      "index_name": "codex-index",
    },
  ],

  // Environment variables
  "vars": {
    "ENVIRONMENT": "production",
    "APP_VERSION": "0.3.0",
  },

  // Scheduled publishing handled by hanawa-scheduler Worker
  // See: packages/hanawa-scheduler/

  // Secrets (set via wrangler secret put):
  // - SESSION_SECRET
  // - CLOUDFLARE_ACCESS_CLIENT_ID (if using Access)
  // - CLOUDFLARE_ACCESS_CLIENT_SECRET
  // - ANTHROPIC_API_KEY (for AI-powered translations)
}
